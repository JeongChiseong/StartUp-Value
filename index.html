<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스타트업 밸류에이션 계산기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .input-box {
            @apply border-2 border-gray-200 rounded-xl p-4 bg-white shadow-sm transition-all duration-200 hover:border-blue-300 focus-within:border-blue-500 focus-within:ring-4 focus-within:ring-blue-100;
        }
        .result-card {
            @apply bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl p-6 shadow-lg;
        }
        .metric-box {
            @apply bg-white bg-opacity-20 rounded-lg p-4 backdrop-blur-sm;
        }
        body {
            font-weight: 600;
        }
        input, select {
            font-weight: 500;
        }
    </style>
</head>
<body class="bg-gray-500 min-h-screen">
    <!-- 헤더 -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-4xl mx-auto px-6 py-6">
            <h1 class="text-3xl font-bold text-gray-800 text-center">🧮 스타트업 밸류에이션 계산기</h1>
            <p class="text-gray-600 text-center mt-2">간단한 입력으로 정확한 기업가치 산정</p>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-6 py-8">
        <!-- 기존 밸류에이션 계산기 -->
        <div class="grid md:grid-cols-2 gap-8 mb-8">
            <!-- 입력 섹션 -->
            <div class="space-y-6">
                <!-- 기본 정보 -->
                <div class="input-box">
                    <h2 class="text-lg font-semibold mb-4 text-gray-800">📋 기본 정보</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">회사명</label>
                            <input type="text" id="companyName" value="사이러스바이크" 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">업종</label>
                            <select id="industry" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="HaaS">HaaS (하드웨어 서비스) - 장비 임대+구독 모델</option>
                                <option value="SaaS">SaaS - 소프트웨어 서비스</option>
                                <option value="E-commerce">E-commerce - 전자상거래 플랫폼</option>
                                <option value="핀테크">핀테크 - 금융기술 서비스</option>
                                <option value="헬스테크">헬스테크 - 의료/건강 기술</option>
                                <option value="IoT/하드웨어">IoT/하드웨어 - 사물인터넷 및 하드웨어 제조</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 매출 정보 -->
                <div class="input-box">
                    <h2 class="text-lg font-semibold mb-4 text-gray-800">💰 재무 정보 (천원)</h2>
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-3 rounded-lg mb-4">
                            <span class="text-sm font-medium text-blue-700">💡 올해 실적이 우선이지만, 전년도 데이터만 있어도 계산 가능합니다</span>
                        </div>
                        
                        <!-- 올해 매출 -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-medium text-gray-800 mb-3">📈 올해 매출 (2024년 기준)</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">하드웨어 매출</label>
                                    <input type="text" id="hardwareSales" placeholder="36,300" 
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                           oninput="formatNumber(this); calculate()">
                                    <span class="text-xs text-gray-500">장비 판매/보증금</span>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">구독 매출</label>
                                    <input type="text" id="subscriptionSales" placeholder="379,260" 
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                           oninput="formatNumber(this); calculate()">
                                    <span class="text-xs text-gray-500">월 구독료 × 12개월</span>
                                </div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded-lg mt-3">
                                <span class="text-sm font-medium">올해 총매출: </span>
                                <span id="currentTotalRevenue" class="text-lg font-bold text-blue-600">0천원</span>
                            </div>
                        </div>

                        <!-- 전년도 매출 -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-medium text-gray-800 mb-3">📊 전년도 매출 (2023년 기준)</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">전년도 총매출</label>
                                    <input type="text" id="previousRevenue" placeholder="250,000" 
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                           oninput="formatNumber(this); calculate()">
                                    <span class="text-xs text-gray-500">작년 전체 매출</span>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">전년도 순이익</label>
                                    <input type="text" id="previousNetIncome" placeholder="25,000" 
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                           oninput="formatNumber(this); calculate()">
                                    <span class="text-xs text-gray-500">작년 순이익</span>
                                </div>
                            </div>
                        </div>

                        <!-- 올해 수익성 -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-medium text-gray-800 mb-3">💹 올해 수익성</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">올해 순이익 (예상)</label>
                                    <input type="text" id="netIncome" placeholder="150,000" 
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                           oninput="formatNumber(this); calculate()">
                                    <span class="text-xs text-gray-500">올해 최종 순이익</span>
                                </div>
                                <div class="bg-green-50 p-3 rounded-lg flex items-center">
                                    <div class="text-center w-full">
                                        <div class="text-sm text-green-700">수익성 개선도</div>
                                        <div id="profitabilityImprovement" class="text-lg font-bold text-green-800">0%p</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>




            </div>

            <!-- 결과 섹션 -->
            <div class="space-y-6">
                <!-- 메인 결과 -->
                <div class="result-card">
                    <h2 class="text-xl font-bold mb-6 text-center">📊 밸류에이션 결과</h2>
                    <div class="space-y-4">
                        <div class="metric-box">
                            <div class="text-sm opacity-90">기업가치 평가</div>
                            <div class="text-2xl font-bold"><span id="valuation">0</span>억원</div>
                        </div>
                        <div class="metric-box">
                            <div class="text-sm opacity-90">주당 가치 (발행주식 100만주 기준)</div>
                            <div class="text-xl font-bold"><span id="sharePrice">0</span>원/주</div>
                        </div>
                    </div>
                </div>

                <!-- 상세 분석 -->
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4">📈 상세 분석</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">업종 기본 배수</span>
                            <span id="industryMultiple" class="font-semibold">8.0배</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">매출 성장률</span>
                            <span id="growthRate" class="font-semibold">0%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">구독 매출 비중</span>
                            <span id="subscriptionRatio" class="font-semibold">0%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">최종 PSR 배수</span>
                            <span id="psrMultiple" class="font-semibold">0배</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">주당 가치</span>
                            <span id="sharePrice2" class="font-semibold">0원</span>
                        </div>
                    </div>
                </div>

                <!-- 투자조건 간단 요약 -->
                <div class="bg-blue-50 rounded-xl p-6 border border-blue-200">
                    <h3 class="text-lg font-semibold text-blue-800 mb-4">💡 기업가치 기반 참고 수치</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-blue-700">4억원 투자시 취득지분:</span>
                            <span id="sampleEquity" class="font-semibold text-blue-800">0%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-700">10억원 투자시 취득지분:</span>
                            <span id="sampleEquity2" class="font-semibold text-blue-800">0%</span>
                        </div>
                        <p class="text-xs text-blue-600 mt-2">※ 실제 CB 조건은 아래에서 상세 설정 가능</p>
                    </div>
                </div>

                <!-- 밸류에이션 결과 확인 -->
                <div class="bg-gradient-to-r from-green-600 to-green-700 text-white font-bold py-4 px-6 rounded-xl text-center">
                    ✅ 기업가치 산정 완료! 아래에서 CB 조건을 설정해보세요
                </div>
            </div>
        </div>

        <!-- CB 시뮬레이션 섹션 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mt-8">
            <div class="border-b pb-4 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                    📊 CB(전환사채) 시뮬레이션
                    <span class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">Convertible Bond</span>
                </h2>
                <p class="text-gray-600 mt-2">위에서 계산된 기업가치를 바탕으로 전환사채 투자 조건을 시뮬레이션합니다.</p>
            </div>

            <!-- CB 개념 설명 -->
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                <h3 class="font-semibold text-blue-800 mb-2">💡 CB(전환사채)란?</h3>
                <p class="text-blue-700 text-sm mb-2">
                    <strong>전환사채(Convertible Bond)</strong>는 처음에는 채권이지만, 나중에 투자자가 원할 때 주식으로 바꿀 수 있는 투자상품입니다.
                </p>
                <div class="grid md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <strong class="text-blue-800">✅ 투자자 장점:</strong>
                        <ul class="text-blue-700 mt-1 ml-4">
                            <li>• 실패시: 원금 + 이자 보장</li>
                            <li>• 성공시: 주식 전환으로 수익 참여</li>
                            <li>• 리픽싱: 주가 하락시 조건 개선</li>
                        </ul>
                    </div>
                    <div>
                        <strong class="text-blue-800">✅ 회사 장점:</strong>
                        <ul class="text-blue-700 mt-1 ml-4">
                            <li>• 낮은 이자율로 자금 조달</li>
                            <li>• 당장 지분 희석 없음</li>
                            <li>• 성장 후 주식 전환</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="grid lg:grid-cols-2 gap-8">
                <!-- CB 조건 설정 -->
                <div class="space-y-6">
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-purple-800 mb-4">🔧 CB 투자 조건 설정</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">투자 금액 (억원)</label>
                                <input type="text" id="cbInvestmentAmount" value="4" 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" 
                                       oninput="calculateCB()">
                                <span class="text-xs text-gray-500">투자하고자 하는 금액을 억원 단위로 입력</span>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">전환 프리미엄 (%)</label>
                                <input type="range" id="conversionPremium" min="10" max="50" step="5" value="20" 
                                       class="w-full" oninput="updatePremiumDisplay(); calculateCB()">
                                <span class="text-xs text-gray-500">현재 주가 대비 전환가격 프리미엄: <span id="premiumDisplay">20</span>%</span>
                                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-2 mt-2">
                                    <p class="text-xs text-yellow-700">
                                        <strong>💡 전환 프리미엄이란?</strong><br>
                                        현재 주가가 1,000원이고 프리미엄 20%라면, 전환가격은 1,200원이 됩니다.<br>
                                        • 투자자 보호: 즉시 전환 방지로 희석 완화<br>
                                        • 회사 이익: 더 높은 가격에 주식 발행<br>
                                        • 일반적 범위: 15-25% (시장 관례)
                                    </p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">만기</label>
                                    <select id="maturity" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" onchange="calculateCB()">
                                        <option value="3">3년</option>
                                        <option value="5">5년</option>
                                        <option value="7">7년</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">연이자율 (%)</label>
                                    <input type="range" id="interestRate" min="1" max="8" step="0.5" value="3" 
                                           class="w-full" oninput="updateInterestDisplay(); calculateCB()">
                                    <span class="text-xs text-gray-500">현재: <span id="interestDisplay">3.0</span>%</span>
                                </div>
                            </div>

                            <div class="border-t pt-4">
                                <h4 class="font-medium text-gray-800 mb-2">🔄 다운사이드 보호 (리픽싱)</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">발동 기준</label>
                                        <select id="repricing" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" onchange="calculateCB()">
                                            <option value="70">전환가의 70% 이하</option>
                                            <option value="80">전환가의 80% 이하</option>
                                            <option value="90">전환가의 90% 이하</option>
                                        </select>
                                        <span class="text-xs text-gray-500">주가가 이 수준 이하면 전환가 하향 조정</span>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">강제전환 조건</label>
                                        <select id="forceConversion" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" onchange="calculateCB()">
                                            <option value="130">전환가의 130% 도달</option>
                                            <option value="150">전환가의 150% 도달</option>
                                            <option value="200">전환가의 200% 도달</option>
                                            <option value="0">강제전환 없음</option>
                                        </select>
                                        <span class="text-xs text-gray-500">주가 상승시 자동 주식 전환</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CB 계산 결과 -->
                <div class="space-y-6">
                    <!-- CB 계산 결과 -->
                    <div class="bg-indigo-600 text-white p-6 rounded-lg">
                        <h3 class="text-lg font-bold mb-4">💰 CB 투자 조건 요약</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>투자금액</span>
                                <span id="cbInvestmentDisplay" class="font-bold">4억원</span>
                            </div>
                            <div class="flex justify-between">
                                <span>전환가격</span>
                                <span id="cbConversionPriceDisplay" class="font-bold">0원/주</span>
                            </div>
                            <div class="flex justify-between">
                                <span>전환시 취득주식</span>
                                <span id="cbShares" class="font-bold">0주</span>
                            </div>
                            <div class="flex justify-between">
                                <span>취득 지분율</span>
                                <span id="cbEquityRatio" class="font-bold">0%</span>
                            </div>
                            <div class="border-t border-indigo-300 pt-2 mt-2">
                                <div class="flex justify-between text-sm">
                                    <span>리픽싱 하한가</span>
                                    <span id="cbRepricingFloor" class="font-medium">0원</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>만기까지 총이자</span>
                                    <span id="cbTotalInterest" class="font-medium">0만원</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 시나리오 분석 -->
                    <div class="bg-white border rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">📈 Exit 시나리오 분석</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="p-2 text-left">시나리오</th>
                                        <th class="p-2 text-right">기업가치</th>
                                        <th class="p-2 text-right">투자자 수익</th>
                                        <th class="p-2 text-right">연복리 IRR</th>
                                    </tr>
                                </thead>
                                <tbody id="scenarioTable">
                                    <!-- 시나리오 데이터가 여기에 삽입됩니다 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 인터랙티브 시뮬레이션 -->
            <div class="mt-8 bg-gray-50 p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-gray-800">⚡ 인터랙티브 시뮬레이션</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Exit시 기업가치 배수: <span id="exitMultiple">1.0</span>배
                        </label>
                        <input type="range" id="exitMultiplier" min="0.5" max="5" step="0.1" value="1.0" 
                               class="w-full" oninput="updateExitSimulation()">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>0.5배 (실패)</span>
                            <span>1.0배 (현재)</span>
                            <span>5.0배 (대성공)</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 mt-4">
                        <div class="bg-white p-4 rounded border">
                            <div class="text-sm text-gray-600">Exit 기업가치</div>
                            <div id="exitValuation" class="text-lg font-bold text-blue-600">0억원</div>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <div class="text-sm text-gray-600">투자자 수익</div>
                            <div id="investorReturn" class="text-lg font-bold text-green-600">0억원</div>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <div class="text-sm text-gray-600">총 수익률</div>
                            <div id="totalReturn" class="text-lg font-bold text-purple-600">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CB vs 일반투자 비교 -->
            <div class="mt-6 bg-green-50 border border-green-200 rounded-lg p-4">
                <h4 class="font-semibold text-green-800 mb-3">🔄 CB vs 일반 지분투자 비교</h4>
                <div class="grid md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <strong class="text-green-700">CB 투자:</strong>
                        <ul class="text-green-600 mt-1 ml-4">
                            <li>• Downside 보호: 원금 + 이자 보장</li>
                            <li>• Upside 참여: 성공시 주식 전환</li>
                            <li>• 리픽싱: 주가 하락 보호</li>
                        </ul>
                    </div>
                    <div>
                        <strong class="text-green-700">일반 지분투자:</strong>
                        <ul class="text-green-600 mt-1 ml-4">
                            <li>• 높은 위험: 실패시 전액 손실</li>
                            <li>• 더 많은 지분: 같은 금액으로 더 많은 지분 취득</li>
                            <li>• 즉시 지분 보유</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- CB 리포트 다운로드 -->
            <div class="mt-6">
                <button onclick="downloadReport()" 
                        class="w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl">
                    📥 CB 투자조건 리포트 다운로드
                </button>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let currentValuation = 0;
        let currentInvestment = 0;
        let currentSharePrice = 0;

        // 유틸리티 함수들
        function formatNumber(input) {
            let value = input.value.replace(/[^\d]/g, '');
            if (value) {
                input.value = Number(value).toLocaleString();
            }
        }

        function parseNumber(str) {
            if (!str) return 0;
            return parseInt(str.replace(/[^\d]/g, '')) || 0;
        }

        function getIndustryMultiple(industry) {
            const multiples = {
                'HaaS': 8.0,
                'SaaS': 12.0,
                'E-commerce': 6.0,
                '핀테크': 10.0,
                '헬스테크': 15.0,
                'IoT/하드웨어': 5.0
            };
            return multiples[industry] || 8.0;
        }

        // 밸류에이션 계산 로직
        function calculateValuation() {
            const hardwareSales = parseNumber(document.getElementById('hardwareSales').value);
            const subscriptionSales = parseNumber(document.getElementById('subscriptionSales').value);
            const previousRevenue = parseNumber(document.getElementById('previousRevenue').value);
            const previousNetIncome = parseNumber(document.getElementById('previousNetIncome').value);
            const netIncome = parseNumber(document.getElementById('netIncome').value);
            const industry = document.getElementById('industry').value;

            // 현재 매출 계산 (올해 데이터 우선, 없으면 전년도 사용)
            let totalRevenue = hardwareSales + subscriptionSales;
            if (totalRevenue === 0 && previousRevenue > 0) {
                totalRevenue = previousRevenue;
            }

            if (totalRevenue === 0) return { valuation: 0, metrics: {} };

            // 기본 지표 계산
            const baseMultiple = getIndustryMultiple(industry);
            const growthRate = previousRevenue > 0 ? ((totalRevenue - previousRevenue) / previousRevenue) * 100 : 0;
            const subscriptionRatio = (hardwareSales + subscriptionSales) > 0 ? 
                (subscriptionSales / (hardwareSales + subscriptionSales)) * 100 : 0;

            // 수익성 개선도 계산
            let profitabilityImprovement = 0;
            if (previousRevenue > 0 && totalRevenue > 0 && previousNetIncome > 0 && netIncome > 0) {
                const previousMargin = (previousNetIncome / previousRevenue) * 100;
                const currentMargin = (netIncome / totalRevenue) * 100;
                profitabilityImprovement = currentMargin - previousMargin;
            }

            // PSR 배수 조정
            let adjustedMultiple = baseMultiple;
            if (growthRate >= 50) adjustedMultiple *= 1.2;
            else if (growthRate < 0) adjustedMultiple *= 0.7;
            if (subscriptionRatio >= 80) adjustedMultiple *= 1.15;
            if (profitabilityImprovement >= 10) adjustedMultiple *= 1.1;

            // 최종 밸류에이션
            const valuation = totalRevenue * adjustedMultiple;
            const sharePrice = valuation * 1000 / 1000000; // 100만주 기준

            return {
                valuation,
                sharePrice,
                metrics: {
                    totalRevenue,
                    baseMultiple,
                    adjustedMultiple,
                    growthRate,
                    subscriptionRatio,
                    profitabilityImprovement
                }
            };
        }

        // 메인 계산 함수
        function calculate() {
            const result = calculateValuation();
            
            currentValuation = result.valuation;
            currentSharePrice = result.sharePrice;

            // UI 업데이트
            updateValuationUI(result);
            calculateCB();
        }

        function updateValuationUI(result) {
            const { valuation, sharePrice, metrics } = result;
            
            // 메인 결과
            document.getElementById('currentTotalRevenue').textContent = metrics.totalRevenue.toLocaleString() + '천원';
            document.getElementById('valuation').textContent = (valuation / 100000).toFixed(1);
            document.getElementById('sharePrice').textContent = sharePrice.toLocaleString() + '원';

            // 상세 분석
            document.getElementById('industryMultiple').textContent = metrics.baseMultiple.toFixed(1) + '배';
            document.getElementById('growthRate').textContent = metrics.growthRate.toFixed(1) + '%';
            document.getElementById('subscriptionRatio').textContent = metrics.subscriptionRatio.toFixed(1) + '%';
            document.getElementById('psrMultiple').textContent = metrics.adjustedMultiple.toFixed(1) + '배';
            document.getElementById('sharePrice2').textContent = sharePrice.toLocaleString() + '원';
            document.getElementById('profitabilityImprovement').textContent = metrics.profitabilityImprovement.toFixed(1) + '%p';

            // 참고 지분율
            const equity4 = valuation > 0 ? (40000 / (valuation + 40000)) * 100 : 0;
            const equity10 = valuation > 0 ? (100000 / (valuation + 100000)) * 100 : 0;
            
            document.getElementById('sampleEquity').textContent = equity4.toFixed(1) + '%';
            document.getElementById('sampleEquity2').textContent = equity10.toFixed(1) + '%';
        }
            document.getElementById('profitabilityImprovement').textContent = profitabilityImprovement.toFixed(1) + '%p';

            // 참고 지분율 계산
            const sample1 = 40000; // 4억원 (천원)
            const sample2 = 100000; // 10억원 (천원)
            const equity1 = (sample1 / (currentValuation + sample1)) * 100;
            const equity2 = (sample2 / (currentValuation + sample2)) * 100;
            
            document.getElementById('sampleEquity').textContent = equity1.toFixed(1) + '%';
            document.getElementById('sampleEquity2').textContent = equity2.toFixed(1) + '%';

            // CB 계산 트리거
            calculateCB();
        } totalShares; // 원 단위

            // 전역 변수 업데이트
            currentInvestment = investment;

            // 결과 업데이트
            document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString() + '천원';
            document.getElementById('valuation').textContent = (currentValuation / 100000).toFixed(1);
            document.getElementById('postMoney').textContent = (postMoneyValuation / 100000).toFixed(1);
            document.getElementById('equity').textContent = equityPercentage.toFixed(1);

            // 상세 분석 업데이트
            document.getElementById('industryMultiple').textContent = baseMultiple.toFixed(1) + '배';
            document.getElementById('growthRate').textContent = growthRate.toFixed(1) + '%';
            document.getElementById('customerGrowthRate').textContent = customerGrowthRate.toFixed(1) + '%';
            document.getElementById('subscriptionRatio').textContent = subscriptionRatio.toFixed(1) + '%';
            document.getElementById('psrMultiple').textContent = adjustedMultiple.toFixed(1) + '배';
            document.getElementById('revenuePerCustomer').textContent = (revenuePerCustomer / 10).toFixed(0) + '만원';
            document.getElementById('sharePrice').textContent = currentSharePrice.toLocaleString() + '원';
            document.getElementById('profitabilityImprovement').textContent = profitabilityImprovement.toFixed(1) + '%p';

            // 투자 조건 업데이트
            document.getElementById('investAmount').textContent = (investment / 100000).toFixed(1) + '억원';
            document.getElementById('finalEquity').textContent = equityPercentage.toFixed(1) + '%';
            document.getElementById('shareValue').textContent = currentSharePrice.toLocaleString() + '원';
            document.getElementById('conversionPrice').textContent = currentSharePrice.toLocaleString() + '원';

            // CB 계산 트리거
            calculateCB();
        }

        // CB 계산 함수
        function calculateCB() {
            if (currentValuation === 0) return;

            const investmentAmount = parseFloat(document.getElementById('cbInvestmentAmount').value) || 4;
            const investmentInThousands = investmentAmount * 100000; // 억원을 천원으로 변환
            const premium = parseInt(document.getElementById('conversionPremium').value);
            const conversionPrice = currentSharePrice * (1 + premium / 100);
            const maturity = parseInt(document.getElementById('maturity').value);
            const interestRate = parseFloat(document.getElementById('interestRate').value);
            const repricingThreshold = parseInt(document.getElementById('repricing').value);
            const forceConversionThreshold = parseInt(document.getElementById('forceConversion').value);

            // 전환 조건 계산
            const cbShares = Math.floor(investmentInThousands * 1000 / conversionPrice);
            const totalShares = 1000000;
            const cbEquityRatio = (cbShares / (totalShares + cbShares)) * 100;
            const repricingFloor = conversionPrice * (repricingThreshold / 100);
            const totalInterest = (investmentInThousands * interestRate * maturity / 100) / 100; // 만원 단위

            // 결과 표시
            document.getElementById('cbInvestmentDisplay').textContent = investmentAmount.toFixed(1) + '억원';
            document.getElementById('cbConversionPriceDisplay').textContent = Math.round(conversionPrice).toLocaleString() + '원/주';
            document.getElementById('cbShares').textContent = cbShares.toLocaleString() + '주';
            document.getElementById('cbEquityRatio').textContent = cbEquityRatio.toFixed(1) + '%';
            document.getElementById('cbRepricingFloor').textContent = Math.round(repricingFloor).toLocaleString() + '원';
            document.getElementById('cbTotalInterest').textContent = totalInterest.toFixed(0) + '만원';

            // 전역 변수 업데이트
            currentInvestment = investmentInThousands;

            // 시나리오 테이블 생성
            generateScenarioTable(conversionPrice, maturity, interestRate, investmentInThousands);
        }

        // 프리미엄 표시 업데이트
        function updatePremiumDisplay() {
            const premium = document.getElementById('conversionPremium').value;
            document.getElementById('premiumDisplay').textContent = premium;
        }

        // 시나리오 테이블 생성
        function generateScenarioTable(conversionPrice, maturity, interestRate, investmentAmount) {
            const scenarios = [
                { name: '실패 (0.5배)', multiplier: 0.5, class: 'text-red-600' },
                { name: '현재 수준 (1.0배)', multiplier: 1.0, class: 'text-gray-700' },
                { name: '성공 (2.0배)', multiplier: 2.0, class: 'text-green-600' },
                { name: '대성공 (5.0배)', multiplier: 5.0, class: 'text-blue-600' }
            ];

            let tableHTML = '';
            scenarios.forEach(scenario => {
                const exitValuation = currentValuation * scenario.multiplier;
                const sharePrice = exitValuation * 1000 / 1000000;
                
                let investorReturn, irr;
                if (sharePrice >= conversionPrice) {
                    // 주식 전환
                    const shares = Math.floor(investmentAmount * 1000 / conversionPrice);
                    investorReturn = (shares * sharePrice) / 1000;
                    irr = (Math.pow(investorReturn / (investmentAmount / 100), 1/maturity) - 1) * 100;
                } else {
                    // 채권 상환
                    investorReturn = investmentAmount / 100 + (investmentAmount * interestRate * maturity / 100 / 100);
                    irr = interestRate;
                }

                tableHTML += `
                    <tr class="${scenario.class}">
                        <td class="p-2 font-medium">${scenario.name}</td>
                        <td class="p-2 text-right">${(exitValuation/100000).toFixed(1)}억원</td>
                        <td class="p-2 text-right">${investorReturn.toFixed(1)}억원</td>
                        <td class="p-2 text-right">${irr.toFixed(1)}%</td>
                    </tr>
                `;
            });

            document.getElementById('scenarioTable').innerHTML = tableHTML;
        }

        // 이자율 표시 업데이트
        function updateInterestDisplay() {
            const rate = document.getElementById('interestRate').value;
            document.getElementById('interestDisplay').textContent = parseFloat(rate).toFixed(1);
        }

        // Exit 시뮬레이션 업데이트
        function updateExitSimulation() {
            const multiplier = parseFloat(document.getElementById('exitMultiplier').value);
            const investmentAmount = parseFloat(document.getElementById('cbInvestmentAmount').value) || 4;
            const investmentInThousands = investmentAmount * 100000;
            const premium = parseInt(document.getElementById('conversionPremium').value);
            const conversionPrice = currentSharePrice * (1 + premium / 100);
            
            document.getElementById('exitMultiple').textContent = multiplier.toFixed(1);

            const exitValuation = currentValuation * multiplier;
            const sharePrice = exitValuation * 1000 / 1000000;

            let investorReturn;
            if (sharePrice >= conversionPrice) {
                const shares = Math.floor(investmentInThousands * 1000 / conversionPrice);
                investorReturn = (shares * sharePrice) / 1000;
            } else {
                const interestRate = parseFloat(document.getElementById('interestRate').value);
                const maturity = parseInt(document.getElementById('maturity').value);
                investorReturn = investmentInThousands / 100 + (investmentInThousands * interestRate * maturity / 100 / 100);
            }

            const returnRate = ((investorReturn - investmentInThousands/100) / (investmentInThousands/100)) * 100;

            document.getElementById('exitValuation').textContent = (exitValuation/100000).toFixed(1) + '억원';
            document.getElementById('investorReturn').textContent = investorReturn.toFixed(1) + '억원';
            document.getElementById('totalReturn').textContent = returnRate.toFixed(1) + '%';
        }

        // 리포트 다운로드 함수 (CB 포함)
        function downloadReport() {
            const companyName = document.getElementById('companyName').value;
            const valuation = (currentValuation / 100000).toFixed(1);
            const investmentAmount = document.getElementById('cbInvestmentAmount').value;
            const conversionPrice = Math.round(currentSharePrice * (1 + parseInt(document.getElementById('conversionPremium').value) / 100));
            
            const reportContent = `
${companyName} 밸류에이션 & CB 투자조건 리포트
=====================================

📊 기업가치 평가 결과
• 기업가치: ${valuation}억원
• 주당 가치: ${currentSharePrice.toLocaleString()}원 (발행주식 100만주 기준)
• 업종: ${document.getElementById('industry').value}
• 총 매출: ${document.getElementById('totalRevenue').textContent}

💰 CB 투자 조건
• 투자금액: ${investmentAmount}억원
• 전환가격: ${conversionPrice.toLocaleString()}원/주
• 전환 프리미엄: ${document.getElementById('conversionPremium').value}%
• 만기: ${document.getElementById('maturity').value}년
• 연이자율: ${document.getElementById('interestRate').value}%
• 리픽싱 기준: 전환가의 ${document.getElementById('repricing').value}% 이하

🔍 주요 특징
• 다운사이드 보호: 원금 + 이자 보장
• 업사이드 참여: 주식 전환으로 성장 수익 참여
• 리픽싱 조항: 주가 하락시 전환가 하향 조정

작성일: ${new Date().toLocaleDateString('ko-KR')}
`;

            const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${companyName}_CB투자조건_리포트.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 초기 계산 실행
        window.onload = function() {
            calculate();
        };
    </script>
</body>
</html>
